# Farmland Map 使用マニュアル

- Farmland Map v2.0
- 2024-08-06
- stpete

---

Fukaya様

複数人が現場で使用することを想定したアプリ修正版(v2.0)が、形になってきましたので、お知らせします。
https://coco-farmland-map.vercel.app/

### 

離れた場所にいる複数人が同時に進捗状況を確認したり進捗記入きるようにするためGoogleDriveを使うことしました。

GitHubにはこれまで通り、progress.csv、polygon.csvを置く、一方で、
所定Google Driveに、progress_update,polygon_masterという新たなスプレッドシートを置きます。
使用するシート、ホルダは共有設定をしているので、同時編集が可能です。
Gmailのアカウントで入リ使用することができます。スプレッドシートはGASを含むため初めて使用する場合は、各人の認証が発生します。

progress_updateが最新の進捗を確認したり、現場で作業する入が入力する場所になります。（PC、スマホ）
行った作業はpulldown列に入力します。自動（onEditのGASが常駐している）で名前（gmailの＠の前の部分）と操作日時が記入されます。（PC、スマホ）
progress_updateはPC上でGASを使ってGitHubとの間でdownload/uploadができます（PCのみ、スマホは不可）。

新たなpolygonを作成した場合、GoogleDriveに集約してファイルを送ることができます。（PC,スマホ）
polygon_masterは、polygonリストの追加や更新が必要になった場合の、編集場所になります。（編集はPC推奨）

polygon_masterはPC上でGASを使ってGitHubとの間でdownload/uploadができます（PCのみ、スマホは不可）。
なお、これらを可能にするために、Google Drive上のファイルとの連携、GAS設定にはファイルID、ホルダのID、さらに
ファイルをGitHubにGASでuploadするためにGitHubのAPI_TOKENのセッティングが必要になっています。

### 

アプリは、GitHub上の　polygonデータを使用して、地図にpolygonを示す。
進捗について、GitHubの情報由来（progress初期値）かGoogleDrive情報由来（realtime値）で表示するかをボタンで切り替えて、
色で進捗を表示できるようにしました。（PC,スマホ）
（スマホからで最新の進捗を地図でも確認できるので、スマホからGASのdownload/uploadを行う必要はなくなりました。）
端末で生成・保存したファイルを選んで所定のGoogleDriveに送信する機能も搭載しました。（PC,スマホ）
端末で新たにpolygonを作った場合、アプリを通じて作成したファイルは共有Driveに集約できます。
地図は航空写真をデフォルトで表示するようにしました。

progress_updateの記入は作業の都度必要ですが、GitHubへのupload/GitHubからのdownloadは、一日１回程度PCから実施すれば十分です。
polygon_masterはpolygonの新規追加や記載の修正が必要になった場合のみ使います。

### 

現在、私のGoogleDriveに設置したホルダを仮の設置場所にして共有可能な状態にしているので、
アプリ基本機能確認の他、SpreadSheetの記入、ファイルのupload/downloadのマクロ操作含めて色々お試しください。

これに合わせて、使用マニュアルv2も改訂を進めて行きます。
ご不明な点やご希望がございましたらお知らせください。

石井



## 主要機能

1. **ポリゴンデータの管理とマップ表示**: 
    - Polygon.csvにポリゴンデータを保存し、地図上に表示します。
2. **進捗データの管理**: 
    - Progress.csvに進捗状況を保存します。進捗状況は地図上のポリゴンの色に反映されます。
3. **進捗データの修正と保存**: 
    - 地図上のポリゴンにクリック/タッチまたはドロップダウンによりregion毎の進捗データを修正します。
    - 全ての進捗状況データをまとめてCSVファイルとして保存できます。
4. **ポリゴンデータの新規作成と保存**: 
    - 新たなポリゴンを作成し、CSVファイルとして保存できます。
5. **現在位置表示**: 
    - 地図が現在位置を中心に表示されるとともに、現在位置を地図上に表示します。

---

## 進捗関係ボタンの使い方

    - 画面の右側に進捗関係ボタンが並んでいます。
- **Load Initial Progress ボタン**:
  - GitHub上のProgress.csvデータを端末で取得します。これにより、各ポリゴンの色が進捗を示すようになります。
  - 進捗状況は右側の列に文字情報でも表示されます（Region番号：進捗状況）

- **Save Progress ボタン**:
  - クリックすると、端末に保存された進捗データをCSVファイルとしてダウンロードします。
  - ファイル名はProgress_{日時}.csvです。必要に応じ、GitHub上のProgress.csvを自分で更新してください。

## 進捗更新ドロップダウンリスト

- **地域選択**:
  - 進捗状況を修正したいregionを選択します。

- **進捗状態選択**:
  - 選択されたregionの新しい進捗状態を選択し、更新します。
  - 更新内容に従い、poligonの色も変わります。
  - 進捗状況には以下の選択肢があります。（）内は対応するprogressの値です。：
    - 未散布(0)
    - 散布中(1)
    - 散布済み(2)
    - 散布中止(3)

## 進捗更新マップクリック

  - 進捗変更は地図上のポリゴンをクリック/タッチすることでも実施可能です。   
  - タッチにより、poligonの色も変わります。

---

## ポリゴン作成関係ボタン類の使い方

    - 画面左下にポリゴン作成関係のボタンが並んでいます。
- **Current Location ボタン**:
  - クリックすると、地図は現在位置を中心に表示され、現在位置を地図上に青色の丸で表示します。

- **Create Polygon ボタン**:
  - ポリゴンの作成モードを開始します。
  - クリック(スマホの場合はタッチ)すると、地図上でクリックしてポリゴンの頂点を追加できます。
  - やり直す場合は、再度、Create Polygon ボタンを押してください。
  - ポリゴンの作成・保存は一つずつです。

- **Save Polygon ボタン**（ポリゴン作成モード時のみ表示）:
  - Polygon Infoを記入するためのpop up windowが画面左上に開きます。
  - Region(管理id番号)とDescriptoion情報（名前など）を記入してwindow内のsaveボタンを押します。
  - 作成したポリゴンのデータがCSV形式で保存されます。ファイル名は、polygo_{region番号}.csvです。
  - 必要に応じ、コピペでGitHub上のPolygon.csvに自分で追加してください。

---

## 主要ファイルの階層構造

- publicホルダの中にPolygonデータ、Progressデータが置かれています。ユーザー自身が管理更新するファイルです。

```
├── pages
│   └── index.tsx
├── components
│   ├── Map.tsx
│   ├── MapComponent.tsx
│   └── InitialDataLoader.tsx
├── lib
│   └── kmlParser.ts (データはcsvで供給するので非使用)
├── public
    ├── Polygon.csv (ユーザー自身が管理更新するファイル)
    └── Progress.csv (ユーザー自身が管理更新するファイル)
```

---
